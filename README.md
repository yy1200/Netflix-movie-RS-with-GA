# 基於基因演算法的電影推薦系統
## Introduction
1. 研究動機
      
    現有的電影推薦系統往往僅能根據單一條件，如類別或人名關鍵字進行搜尋，無法同時滿足我們的多重偏好。因此我們決定設計一個個性化的電影推薦系統，以解決這些問題。這個系統將根據使用者電影類型、導演與演員的偏好，結合過去其他用戶的電影評分，並利用基因演算法進行篩選和排序，同時提高搜尋效率，讓我們能更輕鬆地找到喜歡的電影，享受觀影的樂趣。

2. 研究目的與貢獻
  
    此次的研究目的主要是希望使用者在提出自身對電影的要求之後，能夠更精準地得到適合自己的電影推薦清單。並比較GA和GA content-based在電影推薦系統中的適應度值差距有多少。此外，在此次研究中我們會創建Line Bot 和網頁，讓使用者能更方便地操作電影推薦系統，搜尋適合自己的電影。
## Proposed method
1. 基因演算法（Version 1）
    ![image](https://github.com/yy1200/Netflix_movie_RS_with_GA/assets/92247082/a6e5a8bc-d620-4310-9405-e221aa51b20d)
    1. 初始化編碼：使用排列解的編碼方式，因為總共有3649部電影，也就是3649筆資料，所以創建了一個從0排到3648的染色體，讓每個基因都代表一部電影，再將基因順序打亂，達成隨機的目的，接著再創建一個母體，該母體中總共有NUM_CHROME個染色體，NUM_CHROME為我們所設的參數。
    2. 輪盤式選擇法：從母體中選擇父母，根據染色體的適應度總分來決定每個染色體可能被選到的機率，適應度總分愈高的染色體愈有機率被選中。
    3. 均勻交配：使用排列解的均勻交配，首先從父代中隨機選取兩個父染色體，接著隨機生成長度為電影總數的二進制mask，其中0表示取parent1對應位置的基因，1表示取parent2對應位置的基因，並將其分別分配給子代，然後分別遍歷子代基因，將尚未分配到的位置以另一個父代基因進行填充，最後生成出新的子代。我們選擇使用均勻交配是因為它能將父代染色體中的基因均勻地分配給子代染色體，同時確保子代中沒有重複的基因。
    4. 突變：任選一條染色體，並在該染色體中任選兩個基因，將兩個基因的位置進行交換，而突變次數為突變率乘以染色體個數乘以基因個數。
    5. 計算適應度：主要還是以使用者喜好為主來計算適應度分數。
    6. 適者生存：首先將父代和子代染色體進行合併，並根據適應度對合併後的染色體進行排序，然後將母體中適應度總分最低的染色體去除並替換成子代，以選取出最適合的個體作為下一代的父代。

      根據以上的基因演算法流程可以得知在整個演算法過程中並不會產生不可行解的情況，無論是突變還是交配，皆是在排列解的情況下進行的。
2. 基因演算法（Version 2）
   1.	基因演算法（Version 1）的問題：
        1.	初始化編碼
  
          	0到3648的排列解編碼會導致基因演算法的運行時間過於冗長，無法將世代數、染色體個數、交配率、突變率等四個參數調高，因為一旦調高，使用者需要等待的查詢時間將會長達數個小時，而如果將這四個參數調很小，又會導致基因演算法無法求得較好的解答，適應度函數的總分會無法達到理想的情況。
        2.	計算適應度

        	沒有考慮到使用者輸入的喜好分數會影響到使用者喜好的適應度計算，只有當使用者輸入的喜好分數全部皆為10分且電影類型、演員和導演皆有滿足使用者輸入的資料時，一部電影的使用者喜好總分才有可能是70分，如果使用者輸入的喜好分數很低，將會導致使用者喜好總分下降且低於70分，並間接影響權重的分配，導致最後影響了整個適應度函數的總分，降低了適應度函數的總分上限，且不知道會下降多少。
   2.	改進機制（Version 2）：
        1.	初始化編碼
          根據期末報告當天教授的推薦，我們將編碼方式改成了「隨機編碼」，從0到3648中隨機選出5個不重複的數字，而這5個數字代表了最推薦使用者觀看的前五部電影。如此一來，可加快交配、突變的速率，使得基因演算法在相同參數的情況下所花的時間大幅減少。
        2.	計算適應度
          將使用者輸入的喜好分數考慮進來，一樣以導演為例來解釋如何更改使用者喜好部分的適應度計算，當推薦的五部電影中有某部電影和使用者的喜好重疊時，我們會計算使用者填入對該導演的喜好分數除以使用者所填入的導演喜好分數的加總，確保每部電影的導演適應度分數都落在1分以內，接著為了確保使用者喜好的適應度分數會落在70分之內，需要將電影類型、演員和導演的分數分別乘以70再乘以3。
          根據以上的過程更改計算適應度的方法後，只要某部電影的電影類型、演員和導演皆有滿足使用者輸入的喜好時，就可以拿到滿分為70分的使用者喜好分數，使得計算適應度時不被使用輸入的喜好分數所影響。
        3.	突變
        在每一次突變中都遍歷每一條染色體，並在這5個基因中隨機選擇一個基因位置，將其替換成除了這5部電影外的一部電影基因，以避免同一條染色體中的基因重複，而突變次數為突變率乘以染色體個數乘以基因個數。
   3. GA Version 1與Version 2的比較

      **設定**：相同的使用者偏好及喜好程度，並固定染色體個數以及迭代數
        1. 執行時間
        
            當一位使用者使用電影推薦系統時，Version 1的執行時間大約為1分20秒，也就是說使用者輸入完喜好之後並無法立即獲得電影推薦清單，而是必須等待一段時間，但Version 2的基因演算法卻可以將執行時間縮短至2秒，避免使用者因為等待時間過長而不想使用我們的電影推薦系統。
        
        2. 適應度總分
        
            根據觀察，我們發現Version 1與Version 2跑出的適應度總分以Version 2略勝一籌，在不考慮是否收斂的情況下，可以看到Version 2在第一次迭代中就取得了明顯高於Version 1的成績，雖然在20次迭代中Version 2上升幅度不如Version 1大，但就最後適應度分數來看仍是Version 2為佳。
        
      由此次比較我們發現Version 2可以在極短的時間內跑出較好的成績，因此可以總結出我們針對電影推薦系統的方法改進是成功的。
## Experiment
1. Dataset

   **資料集網址**：https://reurl.cc/N0ZlLx
   
    資料集的影劇類型分為電視劇和電影，將電影的資料集取出來並使用以下資料欄位：
    1.	名稱：電影的名字。
    2.	類型：像是喜劇、奇幻、動作、動畫等等，總共有19個類型可供選擇。
    3.	發行年：電影的發行年分。
    4.	評分：分別有IMDb（Internet Movie Database）和TMDb（The Movie Database），二者皆為很大的電影資料庫，所以我們將其評分納入電影推薦系統的演算法中。
    5.	角色：在資料處理時，將角色分為演員和導演。
2. 實驗設定

   隨機生成50組用戶的偏好，再用這50組固定的用戶偏好去做實驗，分別執行GA(Version 1)與GA(Version 1)＋Content-based的演算法，計算出每位用戶的適應度總分，再取50位用戶的適應度平均值。
3. 實驗數據結果

    超參數的設定如下：
    1.	Pc － [0.7, 0.9]
    2.	Pm － [0.01, 0.1]
    3.	NUM_CHROME － [10, 20]
    4.	ITERATION － [20, 30]
  
    根據四個超參數的設定，產生了16種的排列組合，所以我們總共做了16次的實驗，而參數設定如此小的原因就如前面所述，因為用了不合適的編碼，所以導致演算法會跑很久，為了避免實驗的時間過長，盡可能地減少了迴圈的數量。
## Conclusion
1.	實驗結果比較
    
    **GA與GA＋Content-based的比較**

  	在做完GA與GA＋Content-based的實驗後，我們發現在滿分為500的情況下，兩種方法跑出來的成績都不盡理想，我們推測其原因是主要有兩個，首先是因為每位使用者對電影類型、導演、演員的喜好程度幾乎不會是10分，且在適應度計算中，IMDB及TMDB的平均評分及電影發行年分也幾乎很難取得高分，再來是因為我們選擇的資料集具data sparsity特性，由於電影年份的跨度大，導致在兩部電影中，導演與演員的重複性過低，適應度分數多仰賴電影類型來提升。在種種原因的疊加下，我們實驗所呈現的適應度分數雖離理想情況有一段落差，但這或許已是目前情況下所能跑出的最好結果了，未來也許可以嘗試使用不同的資料集或是改變適應度計算方式來實際測量我們方法的有效性。

  	而進一步對實驗進行分析，可以發現Content based的適應度總分都較GA為低，我們推測Content based適應度總分低的原因是因為我們的迭代次數設的不大，因此GA很難找到實際上分數最高的那一部電影，所以在預測結果不準確的情況下，與他相似度最高的五部電影的適應度分數就很難變高。另外，若是單單比較GA的話，可以發現在第16次實驗的結果是最好的，其參數設置分別是交配率為0.9、突變率為0.1、染色體個數為20、迭代數為30，所以未來拿這個參數再往上調的話可能會有更好的結果。
2. LINE Bot介面

     **LINE Bot demo影片**：https://reurl.cc/QX6EzZ 

   在社交軟體蓬勃發展的時代，我們希望使用者可以快速且方便的使用電影推薦系統，因此架設了LINE Bot聊天機器人，以下為操作流程以及介紹：
      1.	加入好友後，欲使用電影推薦系統時，需輸入start來啟動系統。
      2.	LINE Bot將會詢問使用者喜歡的電影類型，使用者須依照規定的格式選取喜歡的電影類型並輸入對該類型的喜好分數。
      ![image](https://github.com/yy1200/Netflix_movie_RS_with_GA/assets/92247082/5c49b394-9145-48d3-80d2-fd686b8b54d6)
      3.  接下來，LINE Bot將依序詢問使用者喜好的導演和演員，我們在此處設計了四項功能，以下為各個功能的介紹：
          1.	你可能喜歡的導演（演員）：系統將會隨機產生10位導演供使用者參考
          2.	都可以：使用者不想做任何輸入的情況下可以使用
          3.	查詢：根據導演（演員）名字的前幾個英文字母進行搜尋，系統將會回傳與使用者輸入相符的結果
          4.	直接輸入：使用者十分確定導演（演員）的名字時，可以按下該按鈕，並根據規定的格式輸入人名以及對其的喜好分數
      ![image](https://github.com/yy1200/Netflix_movie_RS_with_GA/assets/92247082/dd244b06-b2eb-4f8b-bac1-d5188ff2c1fb)
      ![image](https://github.com/yy1200/Netflix_movie_RS_with_GA/assets/92247082/268a9776-86fd-4b13-ad8d-c8de1635ee67)
      4.	完成輸入，系統回傳「等待推薦系統執行」的訊息
      5.	最後，使用者將得到五部電影的推薦清單，從1到5依序排列，1為最推薦的電影
      ![image](https://github.com/yy1200/Netflix_movie_RS_with_GA/assets/92247082/bbe4d472-100c-4ebf-a9f2-b5fc9ca147d7)
3. 總結與未來展望

    在此次專題中，我們使用了基因演算法實做了Netflix電影推薦系統，並與content-based方法進行了比較，最後提供了LINE Bot及網頁讓使用者可以實際與我們的推薦系統進行互動，並根據自己的需求找到最適合的電影推薦清單，透過這兩種介面的建立也讓我們能夠以使用者的角度檢視介面的設計是否人性化、方便使用，同時也提升了此次專題的完整度。

    而在未來的工作中，如同我們先前所述，在實驗我們的方法是否有效時，可以替換成更均勻、更統一的資料集，以真實地知道使用基因演算法推薦電影的成效性。另外在LINE Bot的部分，我們期望能夠設計出更加直觀、容易操作的介面，並套用基因演算法的改進版本(Version 2)，讓使用者可以方便、快速地與LINE Bot互動，並可以即刻得知適合使用者偏好的推薦結果，而不用還要花費一些時間等待。

    除此之外，我們認為這次的電影推薦系統在網頁上的應用有點少，期許以後可以加上更多擴充的功能到網頁上，使得網頁滿足更多使用者的需求。

